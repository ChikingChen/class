# 如何处理数据

## 背景

**目标域**：采样时长 = 8 s、采样频率 = 32 kHz、速度 ≈ 90 km/h（≈600 rpm）是**确定的**，但**采样位置未知**；

**源域**：**采样位置确定**（DE/FE/BA），但**采样时间不固定**、**采样频率不一致**（12 kHz / 48 kHz 等），且**转速/速度可能缺失或变化**。

## 整理方式

先分三类，DE故障，FE故障以及正常         轴承的故障也可以分为三处，B IR OR

DE故障分为DE（故障处）提取的特征，FE，BA（非故障处）提取的特征

FE故障分为FE（故障处）提取的特征，DE，BA（非故障处）提取的特征

标签：$(DE, FE)\times(B,IR,OR)$ ，6维向量，哪个有故障就哪里标记为1

## 处理方式

### Step 1. 预处理

- 去直流、带通（如 500–10 kHz）。
- 包络（Hilbert），凸显冲击。
- 归一化（z-score）。

### Step 2. 转频估计

- 如果有 RPM → `f_r = RPM/60`。
- 如果无 → 用包络谱、自相关或循环谱估计转频。

### Step 3. 角度重采样

- 计算瞬时相位 `θ(t) = 2π ∫ f_r(t) dt`。
- 在等角网格（0, 2π, 4π, …）上做插值，每转固定 K 点（例如 K=512）。
- 得到角度域信号 `x(θ)`。
- 切片：每 R 转为一片（例如 R=32），得到尺寸 `R × K`。

### Step 4. 阶次变换

- 对角度域序列做 FFT：频轴单位自然就是“阶次”。
- 提取 0–Omax 阶（比如 0–50 阶），裁剪/插值成固定长度 D（例如 D=256）。
- 或者做角度域 STFT：得到 阶次–转数 的二维谱图。

### Step 5. 输出张量

- **阶次谱向量**：形状 `[D]`，可供 MLP/SVM/1D CNN。
- **阶次–时间图**：形状 `[H×W]`（比如 128×128），可供 2D CNN/ViT。

## 转频  使用包络谱估计转频

### 思路

1. 故障冲击在轴承上激发高频共振，经过包络解调后，信号里会出现调制频率 = 转频 frf_rfr。
2. 对包络信号做 FFT，在低频（1–100 Hz）范围找最大峰值 ≈ 转频。

### 步骤

```python
import numpy as np
from scipy.signal import hilbert

def estimate_rpm_envelope(x, fs):
    # 1. Hilbert 包络
    analytic = hilbert(x)
    env = np.abs(analytic)

    # 2. FFT 包络谱
    N = len(env)
    freqs = np.fft.rfftfreq(N, 1/fs)
    spectrum = np.abs(np.fft.rfft(env))

    # 3. 只看低频段（比如 <100Hz）
    mask = (freqs > 0.5) & (freqs < 100)
    freqs_low, spec_low = freqs[mask], spectrum[mask]

    fr_est = freqs_low[np.argmax(spec_low)]
    rpm_est = fr_est * 60
    return fr_est, rpm_est
```

👉 输出的 `fr_est` 就是估计的转频 Hz，`rpm_est` 是 RPM。